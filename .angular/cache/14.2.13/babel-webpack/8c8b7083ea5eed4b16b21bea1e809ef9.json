{"ast":null,"code":"import { environment } from 'src/environments/environment';\nimport Swal from 'sweetalert2';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/user.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\n\nfunction UserEditComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 3)(1, \"h1\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\")(4, \"form\", 6, 7);\n    i0.ɵɵlistener(\"ngSubmit\", function UserEditComponent_div_2_Template_form_ngSubmit_4_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.update());\n    });\n    i0.ɵɵelementStart(6, \"p\")(7, \"label\");\n    i0.ɵɵtext(8, \"Name\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"input\", 8, 9);\n    i0.ɵɵlistener(\"ngModelChange\", function UserEditComponent_div_2_Template_input_ngModelChange_9_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.user.name = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"p\")(12, \"label\");\n    i0.ɵɵtext(13, \"Surname\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"input\", 10, 11);\n    i0.ɵɵlistener(\"ngModelChange\", function UserEditComponent_div_2_Template_input_ngModelChange_14_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.user.surname = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"p\")(17, \"label\");\n    i0.ɵɵtext(18, \"Email\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"input\", 12, 13);\n    i0.ɵɵlistener(\"ngModelChange\", function UserEditComponent_div_2_Template_input_ngModelChange_19_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.user.email = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(21, \"input\", 14);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r0.title);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.user.name);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.user.surname);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.user.email);\n  }\n}\n\nfunction UserEditComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵelement(1, \"img\", 16);\n    i0.ɵɵelementStart(2, \"label\", 17);\n    i0.ɵɵtext(3, \"Upload your image\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"input\", 18);\n    i0.ɵɵlistener(\"change\", function UserEditComponent_div_4_Template_input_change_4_listener($event) {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.fileChangeEvent($event));\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"src\", ctx_r1.url + \"/user/image/\" + ctx_r1.user.image, i0.ɵɵsanitizeUrl);\n  }\n}\n\nfunction UserEditComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"img\", 19);\n    i0.ɵɵelementStart(2, \"label\", 17);\n    i0.ɵɵtext(3, \"Upload your image\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"input\", 18);\n    i0.ɵɵlistener(\"change\", function UserEditComponent_div_5_Template_input_change_4_listener($event) {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.fileChangeEvent($event));\n    });\n    i0.ɵɵelementEnd()();\n  }\n}\n\nexport let UserEditComponent = /*#__PURE__*/(() => {\n  class UserEditComponent {\n    constructor(userSvc) {\n      this.userSvc = userSvc;\n      this.title = 'Update my data';\n      this.url = environment.apiUrl;\n    }\n\n    ngOnInit() {\n      this.identity = this.userSvc.getIdentity();\n      this.token = this.userSvc.getToken();\n      this.user = this.identity;\n    }\n\n    update() {\n      this.userSvc.update(this.user).subscribe({\n        next: resp => {\n          this.user = resp;\n\n          if (this.filesToUpload != null) {\n            this.makeFileRequest(environment.apiUrl + '/user/image/' + this.user.user._id, [], this.filesToUpload).then(result => {\n              this.user.image = result.image;\n              document.getElementById('image_user').setAttribute('src', environment.apiUrl + '/user/image/' + this.user.image);\n            });\n          }\n\n          localStorage.setItem('identity', JSON.stringify(this.user.user));\n          document.getElementById('name_user').innerHTML = this.user.user.name;\n          Swal.fire({\n            icon: 'success',\n            title: 'Success!',\n            text: 'User updated successfully'\n          });\n          this.ngOnInit();\n        },\n\n        error(err) {\n          console.log(err);\n        }\n\n      });\n    }\n\n    fileChangeEvent(file) {\n      this.filesToUpload = file.target.files;\n    }\n\n    makeFileRequest(url, params, files) {\n      return new Promise((resolve, reject) => {\n        const formData = new FormData();\n        const xhr = new XMLHttpRequest();\n\n        for (let i = 0; i < files.length; i++) {\n          formData.append('image', files[i], files[i].name);\n        }\n\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === 4) {\n            if (xhr.status === 200) {\n              resolve(JSON.parse(xhr.responseText));\n            } else {\n              reject(xhr.response);\n            }\n          }\n        };\n\n        xhr.open('POST', url, true);\n        xhr.setRequestHeader('Authorization', this.token);\n        xhr.send(formData);\n      });\n    }\n\n  }\n\n  UserEditComponent.ɵfac = function UserEditComponent_Factory(t) {\n    return new (t || UserEditComponent)(i0.ɵɵdirectiveInject(i1.UserService));\n  };\n\n  UserEditComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: UserEditComponent,\n    selectors: [[\"app-user-edit\"]],\n    decls: 6,\n    vars: 3,\n    consts: [[1, \"container\"], [1, \"row\"], [\"class\", \"col-lg-6\", 4, \"ngIf\"], [1, \"col-lg-6\"], [\"class\", \"imageForEdit\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"col-md-10\", 3, \"ngSubmit\"], [\"userUpdate\", \"ngForm\"], [\"type\", \"text\", \"name\", \"name\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"ngModel\"], [\"type\", \"text\", \"name\", \"surname\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"surname\", \"ngModel\"], [\"type\", \"text\", \"name\", \"email\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"email\", \"ngModel\"], [\"type\", \"submit\", \"value\", \"Update\", 1, \"btn\", \"btn-primary\"], [1, \"imageForEdit\"], [2, \"width\", \"80px\", \"margin\", \"10px\", 3, \"src\"], [1, \"form-label\"], [\"type\", \"file\", \"placeholder\", \"Upload file\", 1, \"form-control\", 3, \"change\"], [\"src\", \"../../assets/gui_user_edit_icon_158355.png\", 2, \"width\", \"180px\", \"margin\", \"10px\"]],\n    template: function UserEditComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1);\n        i0.ɵɵtemplate(2, UserEditComponent_div_2_Template, 22, 4, \"div\", 2);\n        i0.ɵɵelementStart(3, \"div\", 3);\n        i0.ɵɵtemplate(4, UserEditComponent_div_4_Template, 5, 1, \"div\", 4);\n        i0.ɵɵtemplate(5, UserEditComponent_div_5_Template, 5, 0, \"div\", 5);\n        i0.ɵɵelementEnd()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.identity);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.user.image && ctx.user.image != null);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.user.image && ctx.user.image == null);\n      }\n    },\n    dependencies: [i2.NgIf, i3.ɵNgNoValidate, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgControlStatusGroup, i3.RequiredValidator, i3.NgModel, i3.NgForm],\n    encapsulation: 2\n  });\n  return UserEditComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}